---
layout: post
description: "None.NULL"
tweet-text: ""
author: taocp
tags:
- programming
categories:
- ""
---

今天下午编程时遇到一个“难题”，百思不得其解。经过前辈指点，才恍然大悟。
回想过去的几年，虽然写的代码不多，但类似的情形遇到过好几回！

我想，应该将这些问题分门别类，其实很多问题都可以抽象出一个（或多个）相似的“模式”，
解决这类问题有一个共通的方法。
可以多回顾曾经遇到的问题及其对应的解决方案，总结经验教训。

所以写下了这篇文字，会随着编程经验的丰富继续完善本文的。


# 理解现有代码遇到问题

1. 应该先确保正确理解现代码所用的api、工具等

如果是很陌生的api，可能还会仔细查阅手册，减少出错的概率；
但如果看到一个api似乎马上就能理解其意思，但实际行为和用户所理解的不一致，则会导致问题。

遇到过这类问题好几次，我的看法是：

一方面，用户/代码阅读者应该谨慎，如果相应代码表现出异常，则更应该仔细阅读文档；
另一方面，api/代码coder应该保持良好的设计，不要“让用户惊讶”，尽力避免ta人的误解。

# 新技术、新知识

1. 在用新(陌生)技术解决问题、实际应用之前，应当对新东西有一个宏观的、整体的认识。

如果有好的tutorial，不妨跟着做一做，会有更直观的理解；
如果有自动生成的代码，也要弄清生成的代码（模块、文件）的作用，如果可以大致看看代码是怎样的。

# 思维误区

1. “异常”与异常、“正常”与正常

“异常”可能是正常的，而“正常”则是异常的。

例如在某些场景下，操作失败（例如打开文件失败）才是正常的状态，

可能形成思维定势，导致误判。

有个服务系统，之前有个模块A因为特殊原因半年没有跑过单元测试，后来我负责去修复这些测试，保证在A上仍能跑通。
测试代码自己创建了一个模拟A的数据结构B，向其中写入一些数据；并调用真正的模块A，写入同样的数据。
然后用同一个query去查询，并check返回内容应该相同。

跑到某一个case时，发现B返回"NOT FOUND"，而A返回了正常的数据。
我下意识地认为单元测试或B出了问题（单元测试有半年没有和实际代码同步），简单查看了单元测试的逻辑，
发现的确向A和B写入过该query，更加坚定了B有bug的想法。

追查很久陷入了一个死胡同：潜意识里认为B返回"NOT FOUND"是不正常的，但看逻辑B就是应该返回"NOT FOUND"，
而且半年前的这个case是能跑通的，期间没有人修改过测试代码自身的逻辑。
还是同事提醒“可能是A的问题”，可谓一句惊醒梦中人。
想一想测试的逻辑，对应到A中可能的错误，然后`git blame`一把，看看近半年的`commit`，很快就找到了bug.
在那个场景下，的确写入了某个query，但以特定方式去查询时，返回"NOT FOUND"才是正确的行为。
